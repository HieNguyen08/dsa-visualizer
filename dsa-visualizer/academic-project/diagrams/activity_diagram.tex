\documentclass[tikz,border=10pt]{standalone}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[vietnamese]{babel}
\usepackage{tikz}
\usetikzlibrary{shapes.geometric, arrows, positioning, shapes.multipart, fit}

\tikzset{
    start/.style={
        circle,
        fill=black,
        minimum size=0.3cm
    },
    end/.style={
        circle,
        draw,
        double,
        minimum size=0.3cm
    },
    activity/.style={
        draw,
        rectangle,
        rounded corners,
        minimum width=2.5cm,
        minimum height=0.8cm,
        text centered,
        font=\scriptsize,
        text width=2.3cm,
        align=center
    },
    decision/.style={
        draw,
        diamond,
        minimum width=1.5cm,
        minimum height=1cm,
        text centered,
        font=\tiny,
        text width=1.3cm,
        align=center
    },
    fork/.style={
        draw,
        rectangle,
        fill=black,
        minimum width=3cm,
        minimum height=0.1cm
    },
    swimlane/.style={
        draw,
        rectangle,
        minimum width=4cm,
        minimum height=15cm,
        text centered,
        font=\small
    }
}

\begin{document}
\begin{tikzpicture}[node distance=1.8cm]

% Title
\node[above] at (0,15) {\Large \textbf{Activity Diagram - DSA Learning Process}};

% ===== SWIMLANES =====
\node[swimlane] (student_lane) at (-7,6) {};
\node[above] at (-7,14) {\textbf{Student}};

\node[swimlane] (system_lane) at (-1,6) {};
\node[above] at (-1,14) {\textbf{DSA Platform}};

\node[swimlane] (ai_lane) at (5,6) {};
\node[above] at (5,14) {\textbf{AI Assistant}};

% ===== STUDENT ACTIVITIES =====
\node[start] (start) at (-7,13) {};

\node[activity] (login) at (-7,11.5) {User Login\\Authentication};

\node[activity] (select_topic) at (-7,10) {Select Learning\\Topic/Algorithm};

\node[activity] (read_theory) at (-7,8.5) {Read Theory\\Materials};

\node[decision] (understand_theory) at (-7,7) {Theory\\Clear?};

\node[activity] (start_visualization) at (-7,5.5) {Start Algorithm\\Visualization};

\node[activity] (interact_demo) at (-7,4) {Interact with\\Demo};

\node[decision] (practice_needed) at (-7,2.5) {Need More\\Practice?};

\node[activity] (complete_assessment) at (-7,1) {Complete\\Assessment};

\node[end] (end) at (-7,-0.5) {};

% ===== SYSTEM ACTIVITIES =====
\node[activity] (validate_user) at (-1,11.5) {Validate User\\Credentials};

\node[activity] (load_content) at (-1,10) {Load Algorithm\\Content};

\node[activity] (prepare_visualizer) at (-1,8.5) {Initialize\\Visualizer};

\node[activity] (render_animation) at (-1,5.5) {Render Step-by-step\\Animation};

\node[activity] (track_progress) at (-1,4) {Track User\\Progress};

\node[activity] (generate_practice) at (-1,2.5) {Generate Practice\\Problems};

\node[activity] (save_results) at (-1,1) {Save Assessment\\Results};

% ===== AI ASSISTANT ACTIVITIES =====
\node[activity] (analyze_difficulty) at (5,10) {Analyze Content\\Difficulty};

\node[activity] (provide_explanation) at (5,8.5) {Provide Contextual\\Explanations};

\node[activity] (adaptive_hints) at (5,7) {Provide Adaptive\\Hints};

\node[activity] (real_time_help) at (5,5.5) {Real-time\\Assistance};

\node[activity] (suggest_improvements) at (5,4) {Suggest Learning\\Improvements};

\node[activity] (personalize_content) at (5,2.5) {Personalize Next\\Learning Path};

\node[activity] (evaluate_performance) at (5,1) {Evaluate Learning\\Performance};

% ===== FLOW CONNECTIONS =====
% Main student flow
\draw[->] (start) -- (login);
\draw[->] (login) -- (select_topic);
\draw[->] (select_topic) -- (read_theory);
\draw[->] (read_theory) -- (understand_theory);
\draw[->] (understand_theory) -- node[right,font=\tiny] {Yes} (start_visualization);
\draw[->] (start_visualization) -- (interact_demo);
\draw[->] (interact_demo) -- (practice_needed);
\draw[->] (practice_needed) -- node[right,font=\tiny] {No} (complete_assessment);
\draw[->] (complete_assessment) -- (end);

% Loop back connections
\draw[->] (understand_theory) -| node[above,font=\tiny] {No} (-9,7) |- (read_theory);
\draw[->] (practice_needed) -| node[above,font=\tiny] {Yes} (-9,2.5) |- (start_visualization);

% System interactions
\draw[->] (login) -- (validate_user);
\draw[->] (select_topic) -- (load_content);
\draw[->] (read_theory) -- (prepare_visualizer);
\draw[->] (start_visualization) -- (render_animation);
\draw[->] (interact_demo) -- (track_progress);
\draw[->] (practice_needed) -- (generate_practice);
\draw[->] (complete_assessment) -- (save_results);

% AI interactions
\draw[->] (load_content) -- (analyze_difficulty);
\draw[->] (prepare_visualizer) -- (provide_explanation);
\draw[->] (understand_theory) -- (adaptive_hints);
\draw[->] (render_animation) -- (real_time_help);
\draw[->] (track_progress) -- (suggest_improvements);
\draw[->] (generate_practice) -- (personalize_content);
\draw[->] (save_results) -- (evaluate_performance);

% Cross-lane feedback
\draw[->] (adaptive_hints) -- (understand_theory);
\draw[->] (real_time_help) -- (interact_demo);
\draw[->] (personalize_content) -- (practice_needed);
\node[activity] (practice_code) at (-6,1) {Luyện tập code};
\node[decision] (need_help) at (-6,-0.5) {Cần hỗ trợ?};
\node[activity] (complete_exercise) at (-6,-2) {Hoàn thành bài tập};

% Activities in System lane
\node[activity] (load_algorithm) at (-1,8.5) {Tải thuật toán};
\node[activity] (display_theory) at (-1,7) {Hiển thị lý thuyết};
\node[activity] (prepare_visualization) at (-1,4) {Chuẩn bị visualization};
\node[activity] (render_animation) at (-1,2.5) {Render animation};
\node[activity] (code_playground) at (-1,1) {Mở code playground};
\node[activity] (run_performance_test) at (-1,-0.5) {Chạy kiểm tra hiệu suất};
\node[activity] (save_progress) at (-1,-2) {Lưu tiến độ};
\node[activity] (generate_certificate) at (-1,-3.5) {Tạo chứng chỉ};

% Activities in AI lane
\node[activity] (provide_explanation) at (4,5.5) {Giải thích bổ sung};
\node[activity] (generate_hints) at (4,1) {Tạo gợi ý};
\node[activity] (optimize_code) at (4,-0.5) {Tối ưu code};
\node[activity] (answer_questions) at (4,-2) {Trả lời câu hỏi};

% End states
\node[end] (end_success) at (-1,-5) {};

% Main flow arrows
\draw[->] (start) -- (select_algorithm);
\draw[->] (select_algorithm) -- (load_algorithm);
\draw[->] (load_algorithm) -- (read_theory);
\draw[->] (read_theory) -- (display_theory);
\draw[->] (display_theory) -- (understand);

% Understanding decision
\draw[->] (understand) -- (start_visualization) node[midway,right] {Có};
\draw[->] (understand) -- (provide_explanation) node[midway,above] {Không};
\draw[->] (provide_explanation) -- ++(0,-3) -| (read_theory);

\draw[->] (start_visualization) -- (prepare_visualization);
\draw[->] (prepare_visualization) -- (interact_demo);
\draw[->] (interact_demo) -- (render_animation);
\draw[->] (render_animation) -- (practice_code);
\draw[->] (practice_code) -- (code_playground);
\draw[->] (code_playground) -- (need_help);

% Help decision
\draw[->] (need_help) -- (complete_exercise) node[midway,right] {Không};
\draw[->] (need_help) -- (generate_hints) node[midway,above] {Có};
\draw[->] (generate_hints) -- (optimize_code);
\draw[->] (optimize_code) -- (answer_questions);
\draw[->] (answer_questions) -- ++(0,-1) -| (practice_code);

\draw[->] (complete_exercise) -- (run_performance_test);
\draw[->] (run_performance_test) -- (save_progress);
\draw[->] (save_progress) -- (generate_certificate);
\draw[->] (generate_certificate) -- (end_success);

% Dotted lines for swimlane boundaries
\draw[dashed, gray] (-3.5,11) -- (-3.5,-5.5);
\draw[dashed, gray] (1.5,11) -- (1.5,-5.5);

\end{tikzpicture}
\end{document}

